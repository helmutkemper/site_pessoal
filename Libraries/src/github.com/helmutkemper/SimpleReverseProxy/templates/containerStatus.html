<!DOCTYPE html>
<html>
<head>
  <!--base href="https://demos.telerik.com/kendo-ui/grid/keyboard-navigation"-->
  <style>html { font-size: 14px; font-family: Arial, Helvetica, sans-serif; }</style>
  <title></title>
  <link rel="stylesheet" href="/static/kendo-ui/styles/kendo.common-material.min.css" />
  <link rel="stylesheet" href="/static/kendo-ui/styles/kendo.material.min.css" />
  <link rel="stylesheet" href="/static/kendo-ui/styles/kendo.material.mobile.min.css" />

  <script src="/static/kendo-ui/js/jquery.min.js"></script>
  <script src="/static/kendo-ui/js/kendo.all.min.js"></script>
  <style>

    .centerText {
      text-align: center;
      width: 100%;
    }

    /* Success template - start */
    .k-notification-success {
      background: rgba(0%,60%,0%,.7);
      color: #fff;
    }
    .success {
      width: 280px;
      height: 80px;
      padding: 0 30px;
      line-height: 55px;
    }
    .success h3 {
      font-size: 1em;
      font-weight: normal;
      display: inline-block;
      vertical-align: middle;
    }
    .success img {
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
    }
    /* Success template - end */

    .containerLog{
      max-height: 300px;
      overflow: auto;
    }



    .containerData {
      border-collapse: collapse;
      width: 100%;
    }
    .k-window-content h2 {
      margin-bottom: 2px;
      margin-top: 5px;
    }
    .k-window-content em {
      font-size: 10px;
    }
    .containerData td {
      padding: 0;
      vertical-align: bottom;
      height: 30px;

      font-size: 1.0em;
      font-weight: normal;
      line-height: 20px;
    }
    .containerData td.col1 {
      width: 90px;
    }
    .containerData td.col2 {
      width: 508px;
    }
    .containerData td.col3 {
      width: 60px;
    }
    .containerData th, td {
      border-bottom: 1px solid #eee;
    }
    .containerData td.value span {
      font-size: .5em;
      vertical-align: top;
      line-height: 30px;
    }

    .bug {
      font-size: 10px;
      color: #ff0000;
    }












    #fieldlist {
      margin: 0;
      padding: 0;
    }

    #fieldlist label .k-numerictextbox {
      font-size: 14px;
    }

    #fieldlist li {
      list-style: none;
      padding-bottom: .7em;
      text-align: left;
    }

    #fieldlist label {
      display: block;
      padding-top: 1em;
      padding-bottom: .3em;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 12px;
      color: #444;
    }

    #fieldlist span.status {
      text-align: center;
    }

    #fieldlist span .k-widget:not(.k-tooltip),
    #fieldlist span .k-textbox {
      margin: 0 5px 5px 0;
    }

    #fieldlist span input[type="checkbox"] {
      margin: 0 5px 0 0;
    }

    .k-combobox {
      width: 624px;
    }

    .k-combobox input[type="text"] {
      width: 622px !important;
    }

    #fieldlist span input[type="text"] {
      width: 624px;
    }

    #ExposedPortsNumber span input[type="text"] {
      width: 624px;
    }

    /* numeric text box - inicio */
    .oneThirdSize span input[type="text"] .k-autocomplete, .k-numerictextbox {
      width: 227px !important;
    }

    .envVarSize {
      width: 427px !important;
    }

    .oneThirdSize span input[type="text"] .k-formatted-value, .oneThirdSize, .k-input {
      width: 224px !important;
    }
    /* numeric text box - fim */

    #fieldlist .k-textbox {
      border-color: #cccccc;
    }

    .confirm {
      padding-top: 1em;
    }

    .valid {
      color: green;
    }

    .invalid {
      color: red;
    }

    /*#fieldlist li input[type="checkbox"] {
      margin: 0 5px 0 0;
    }*/

    span.k-widget.k-tooltip-validation {
      display: inline-block;
      width: 160px;
      text-align: left;
      border: 0;
      padding: 0;
      margin: 0;
      background: none;
      box-shadow: none;
      color: red;
    }



    .k-dropdown-wrap.k-state-default {
      border-color: #cccccc;
    }

    .k-tooltip-validation .k-warning {
      display: none;
    }
  </style>
</head>
<body>
<div>
  <!-- código apenas para teste - inicio -->
  <a id="createAContainerIconTextButton">Create a container</a><br><br>
  <!-- código apenas para teste - fim -->

  <!-- Monta o grid onde são mostrados todos os conteines, ativos e inativos do sistema - inicio -->
  <div id="containerListAndDetailsGridView"></div>
  <!-- Monta o grid onde são mostrados todos os conteines, ativos e inativos do sistema - fim -->

  <!-- Mostra os detalhes do container - inicio -->
  <div id="containerDetailsWindowView"></div>
  <!-- Mostra os detalhes do container - fim -->

  <div id="containerHostExposedPortsAddNewPort"></div>
  <div id="containerHostEnvAddNewEnvVar"></div>




  <!-- Conteúdo da janela que adiciona container - inicio -->
  <div id="windowCreateContainer" class="k-content">
    <form id="ticketsForm">
      <ul id="containerCreatePanelBarContent">
        <li class="k-state-active">
          <span class="k-link k-state-selected">Basic configuration</span>
          <div>
            <ul id="fieldlist">
            <span>
              <label for="name" class="required" title="Container name">Container Name</label>
              <input type="text" id="containerConfigurationName" name="name" class="k-textbox" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
            </span>
              <span>
              <label for="image" class="required" title="Name of the image as it was passed by the operator (e.g. could be symbolic)">Image</label>
              <input type="text" id="containerConfigurationImageName" name="image" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
            </span>
              <span>
              <label for="WaitForErrors" title="Waits for error messages before releasing the container creation process">Wait for errors</label>
              <input type="checkbox" id="containerConfigurationWaitForErrors" name="waitforerrors" checked="checked" />
            </span>
              <span>
              <label for="ExposedPorts" title="List of exposed ports from container">Container Exposed Ports And Protocol</label>
              <select id="containerHostExposedPorts" name="ExposedPorts" autocomplete="off"></select>
            </span>
              <span>
              <label for="env" title="List of environment variable to set in the container">Environment Variable</label>
              <select id="containerHostEnv" name="env" autocomplete="off"></select>
            </span>
            </ul>
          </div>
        </li>





        <li>
          <span class="k-link k-state-selected">Advanced</span>
          <div style="padding: 10px;">
            <ul id="fieldlist">
            <span>
              <label for="hostname" title="Host name">Host name</label>
              <input type="text" id="hostname" name="hostname" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
            </span>
              <span>
              <label for="domainname" title="Domain name">Domain name</label>
              <input type="text" id="domainname" name="domainname" class="k-textbox" placeholder="" validationMessage="Enter a {0}"  autocomplete="off"/>
            </span>
              <span>
              <label for="user" title="User that will run the command(s) inside the container, also support user:group">User</label>
              <input type="text" id="user" name="user" class="k-textbox" placeholder="user or user:group" validationMessage="Enter a {0}"  autocomplete="off"/>
            </span>
              <span>
              <label for="attachStdin" title="Attach the standard input, makes possible user interaction">Attach std in</label>
              <input type="checkbox" id="attachStdin" name="attachStdin" checked="checked" />
            </span>
              <span>
              <label for="attachStdout" title="Attach the standard output, makes possible user interaction">Attach std out</label>
              <input type="checkbox" id="attachStdout" name="attachStdout" checked="checked" />
            </span>
              <span>
              <label for="attachStderr" title="Attach the standard error, makes possible user interaction">Attach std error</label>
              <input type="checkbox" id="attachStderr" name="attachStderr" checked="checked" />
            </span>
              <span>
              <label for="try" title="Attach standard streams to a tty, including stdin if it is not closed.">Try</label>
              <input type="checkbox" id="try" name="try" checked="checked" />
            </span>
              <span>
              <label for="openStdin" title="Open standard in">Open standard in</label>
              <input type="checkbox" id="openStdin" name="openStdin" checked="checked" />
            </span>
              <span>
              <label for="stdinOnce" title="If true, close stdin after the 1 attached client disconnects.">Std in once</label>
              <input type="checkbox" id="stdinOnce" name="stdinOnce" />
            </span>

              <!-- cmd -->
              <!-- Healthcheck -->

              <span>
              <label for="argsEscaped" title="True if command is already escaped (Windows specific)">Args Escaped</label>
              <input type="checkbox" id="argsEscaped" name="argsEscaped" />
            </span>
              <span>
              <label for="workingrir" title="Name of the image as it was passed by the operator (e.g. could be symbolic)">Working dir</label>
              <input type="text" id="workingrir" name="workingrir" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
            </span>

              <!-- Entrypoint -->

              <span>
              <label for="networkdisabled" title="Is network disabled">Network Disabled</label>
              <input type="checkbox" id="networkdisabled" name="networkdisabled" />
            </span>
              <span>
              <label for="macaddress" title="Mac Address of the container">Mac Address of the container</label>
              <input type="text" id="macaddress" name="macaddress" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
            </span>

              <!-- OnBuild -->
              <!-- Labels -->

              <span>
              <label for="stopsignal" title="Signal to stop a container">Stop Signal</label>
              <input type="text" id="stopsignal" name="stopsignal" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
            </span>
              <span><!-- deve ser numerico -->
              <label for="stoptimeout" title="Timeout (in seconds) to stop a container">Stop Timeout</label>
              <input id="stoptimeout" name="stoptimeout" type="text" min="0" value="0" data-max-msg="Enter value between 0 and 1000" class="k-textbox" placeholder="" autocomplete="off" />
              <span class="k-invalid-msg" data-for="stoptimeout"></span>
            </span>

              <!-- shell -->

            </ul>
          </div>
        </li>
        <li>
          Projects
          <ul>
            <li>New Business Plan</li>
            <li>
              Sales Forecasts
              <ul>
                <li>Q1 Forecast</li>
                <li>Q2 Forecast</li>
                <li>Q3 Forecast</li>
                <li>Q4 Forecast</li>
              </ul>
            </li>
            <li>Sales Reports</li>
          </ul>

        </li>
        <li>
          Programs
          <ul>
            <li>Monday</li>
            <li>Tuesday</li>
            <li>Wednesday</li>
            <li>Thursday</li>
            <li>Friday</li>
          </ul>
        </li>
        <li disabled="disabled">
          Communication
        </li>
      </ul>













    </form>
  </div>
  <!-- Conteúdo da janela que adiciona container - fim -->

  <script>
    var containerHostExposedPortsItemsCount = -1;
    var containerHostExposedPortsItemsIdToAdd = -1;
    var containerHostEnvItemsCount = -1;
    var containerHostEnvItemsIdToAdd = -1;

    var windowContainerDetails, detailsTemplate;
    var lastContainerStatusOldValue = {};
    var containerStatisticsSetIntervalId;
    var containerStatisticsWaitingData = false;
    var containerStatisticMemPercentData = [];
    var containerStatisticCpuPercentData = [];
    var containerStatisticBlkReadData = [];
    var containerStatisticBlkWriteData = [];
    var containerStatisticNetRxData = [];
    var containerStatisticNetTxData = [];
    var containerStatisticPidsStatsCurrentData = [];


    var containerConfigurationNameRef;
    var containerConfigurationImageNameRef;
    var containerConfigurationWaitForErrorsRef;
    var containerConfigurationExposedPortsNumberRef;
    var containerConfigurationEnvVarNameRef;
    /*var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration*/

    var containerHostExposedPortsRef;
    var containerHostExposedPortsAddNewPortDialogWindowRef;
    var containerHostEnvRef;
    var containerHostEnvAddNewPortDialogWindowRef;

    $(document).ready(function() {

      containerHostExposedPortsAddNewPortDialogWindowRef = $("#containerHostExposedPortsAddNewPort");
      containerHostEnvAddNewPortDialogWindowRef = $("#containerHostEnvAddNewEnvVar");

      $("#containerHostEnv").kendoMultiSelect({
        filter: "contains",
        placeholder: "",
        itemTemplate: kendo.template($("#containerHostEnvTemplate").html()),
        noDataTemplate: kendo.template($("#containerHostEnvNoDataTemplate").html()),
        footerTemplate: kendo.template($("#containerHostEnvFooterTemplate").html()),
        dataTextField: "EnvVar",
        dataValueField: "Id",
        dataSource: new kendo.data.DataSource({
          schema: {
            model: {
              id: "Id",
              fields: {
                Id: { type: "number" },
                EnvVar: { type: "string" }
              }
            }
          }
        })
      });
      containerHostEnvRef = $("#containerHostEnv").data("kendoMultiSelect");


      containerConfigurationNameRef = $("#containerConfigurationName");

      $("#containerConfigurationImageName").kendoComboBox({
        dataSource: new kendo.data.DataSource({
          transport: {
            read: function(options) {
              $.ajax({
                type: "GET",
                url: "http://panel.localhost:8888/restImageList",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: function(data) {
                  var newData = [];
                  for( var i in data.Objects ){
                    i = parseInt(i);
                    newData.push({
                      id: data.Objects[i].Id,
                      name: data.Objects[i].RepoTags[0],
                      created: new Date( data.Objects[i].Created * 1000 ),
                      labels: data.Objects[i].Labels,
                      repoDigests: data.Objects[i].RepoDigests,
                      repoTags: data.Objects[i].RepoTags,
                      size: data.Objects[i].Size,
                      virtualSize: data.Objects[i].VirtualSize,
                    });
                  }

                  options.success(newData);
                }
              });
            }
          },
        }),
        dataTextField: "name",
        dataValueField: "id",
        width: 624
      });

      containerConfigurationImageNameRef = $("#containerConfigurationImageName").data("kendoComboBox");

      $("#stoptimeout").kendoNumericTextBox();

      $("#containerHostExposedPorts").kendoMultiSelect({
        filter: "contains",
        placeholder: "",
        itemTemplate: kendo.template($("#containerHostExposedPortsTemplate").html()),
        noDataTemplate: kendo.template($("#containerHostExposedPortsNoDataTemplate").html()),
        footerTemplate: kendo.template($("#containerHostExposedPortsFooterTemplate").html()),
        dataTextField: "Value",
        dataValueField: "Id",
        dataSource: new kendo.data.DataSource({
          schema: {
            model: {
              id: "Id",
              fields: {
                Id: { type: "number" },
                Value: { type: "string" },
                ImageName: { type: "string" }
              }
            }
          }
        })
      });
      containerHostExposedPortsRef = $("#containerHostExposedPorts").data("kendoMultiSelect");


      $("#containerConfigurationWaitForErrors").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });

      containerConfigurationWaitForErrorsRef = $("#containerConfigurationWaitForErrors").data("kendoMobileSwitch");


      $("#attachStdin").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#attachStdout").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#attachStderr").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#try").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#openStdin").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#stdinOnce").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#argsEscaped").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });
      $("#networkdisabled").kendoMobileSwitch({ onLabel: "On", offLabel: "Off" });

      $("#containerCreatePanelBarContent").kendoPanelBar({});
      /*
      Name: "mongo_test",
      Docker: container.DockerConfig{
        Image: "mongo:latest",
        AttachStdin: true,
        AttachStdout: true,
        AttachStderr: true,
        OpenStdin: true,
        Cmd: []string{},
        ExposedPorts: nat.PortSet{
          "27018/tcp": struct{}{},
        },
      },
      Host: container.HostConfig{
        PortBindings: nat.PortMap{
          "27017/tcp": []nat.PortBinding{
            {
              HostPort: "27018",
            },
          },
        },
        Binds: []string{
          "/etc/mongod.conf:/etc/mongod.conf",
        },
      }
      */
      $("#windowCreateContainer").kendoWindow({
        title: "Create Container",
        //data: {id: ""},
        modal: true,
        visible: false,
        resizable: true,
        width: 700,
        height: 400,
        actions: [
          "Maximize",
          "Close"
        ],
        close: function(){

        },
        open: function(){

        }
      }).data("kendoWindow").center();

      $("#createAContainerIconTextButton").kendoButton({
        icon: "plus",
        click: function(e){
          $("#windowCreateContainer").data("kendoWindow").open().maximize();
        }
      });

      $("#containerListAndDetailsGridView").kendoGrid({
        dataSource: new kendo.data.DataSource({
          transport: {
            read: function(options) {
              $.ajax({
                type: "GET",
                url: "http://panel.localhost:8888/restContainerList",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                //data: JSON.stringify({key: "value"}),
                success: function(data) {
                  var newData = [];
                  for( var i in data.Objects ){
                    i = parseInt(i);
                    newData.push({
                      id: data.Objects[i].Id,
                      name: data.Objects[i].Names[0],
                      image: data.Objects[i].Image,
                      createdYear: new Date( data.Objects[i].Created * 1000 ),
                      createdHour: new Date( data.Objects[i].Created * 1000 ),
                      version: data.Objects[i].Labels.VERSION,
                      state: data.Objects[i].State,
                      status: data.Objects[i].Status
                    });
                  }

                  options.success(newData);
                }
              });
            }
          },
          pageSize: 25,
        }),
        //height: 500,
        navigatable: true,
        filterable: true,
        sortable: true,
        pageable: true,
        reorderable: true,
        resizable: true,
        columns: [
          {
            field: "name",
            width: 240,
            title: "Name"
          },
          {
            field: "image",
            width: 120,
            title: "Image"
          },
          {
            field: "createdYear",
            width: 80,
            title: "Created Day",
            template: '#= kendo.toString(createdYear,"dd/MM/yyyy") #'

          },
          {
            field: "createdHour",
            width: 60,
            title: "Created Hour",
            template: '#= kendo.toString(createdHour,"HH:mm") #'

          },
          {
            field: "version",
            width: 120,
            title: "Version",
          },
          {
            field: "state",
            width: 120,
            title: "State",
          },
          { command: { text: "View Details", click: showDetails }, title: " ", width: "180px" }
        ]
      });

      setInterval(function(){
        $.ajax({
          type: "GET",
          url: "http://panel.localhost:8888/restContainerList",
          contentType: "application/json; charset=utf-8",
          dataType: 'json',
          //data: JSON.stringify({key: "value"}),
          success: function(data) {
            let lastContainerStatusNewValue = {};

            for( let i in data.Objects ){
              i = parseInt(i);
              if( lastContainerStatusNewValue[data.Objects[i].State] === undefined){
                lastContainerStatusNewValue[data.Objects[i].State] = 1;
              }
              else {
                lastContainerStatusNewValue[data.Objects[i].State] += 1;
              }
            }

            let pass = true;

            try {
              for (let i in lastContainerStatusNewValue) {
                if (lastContainerStatusNewValue[i] !== lastContainerStatusOldValue[i]) {
                  pass = false;
                  break;
                }
              }

              for (let i in lastContainerStatusOldValue) {
                if (lastContainerStatusNewValue[i] !== lastContainerStatusOldValue[i]) {
                  pass = false;
                  break;
                }
              }
            }
            catch (e) {
              pass = false;
            }

            if( pass === true ){
              return;
            }

            lastContainerStatusOldValue = lastContainerStatusNewValue;

            let newData = [];
            for( let i in data.Objects ){
              i = parseInt(i);
              newData.push({
                id: data.Objects[i].Id,
                name: data.Objects[i].Names[0],
                image: data.Objects[i].Image,
                createdYear: new Date( data.Objects[i].Created * 1000 ),
                createdHour: new Date( data.Objects[i].Created * 1000 ),
                version: data.Objects[i].Labels.VERSION,
                state: data.Objects[i].State,
                status: data.Objects[i].Status
              });
            }

            $("#containerListAndDetailsGridView").data("kendoGrid").dataSource.read();
          }
        });

      }, 2000);

      windowContainerDetails = $("#containerDetailsWindowView").kendoWindow({
        title: "Container Details",
        data: {id: ""},
        modal: true,
        visible: false,
        resizable: false,
        width: 700,
        height: 400,
        close: function(){
          clearInterval( containerStatisticsSetIntervalId );
        },
        open: function(){
          console.log("window id:", this.options.data.id);
          containerStatisticsSetIntervalId = setInterval(getContainerStatistics, 1000, this.options.data.id);
        }
      }).data("kendoWindow");

      detailsTemplate = kendo.template($("#containerDetailsTemplate").html());

      function showDetails(e) {
        e.preventDefault();

        let url = "";
        let dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        windowContainerDetails.options.data.id = dataItem.id;
        windowContainerDetails.content(detailsTemplate(dataItem));
        windowContainerDetails.center().open();

        let popupNotification = $("#popupNotification").kendoNotification({
          stacking: "down",
          templates: [{
            type: "success",
            template: $("#successTemplate").html()
          }]

        }).data("kendoNotification");

        $("#containerActions").kendoButtonGroup({
          select: function (e) {
            let windowContainerDetails = $("#containerDetailsWindowView").data("kendoWindow");

            windowContainerDetails.close();

            switch( e.indices[0] ){
              case 0:
                $.ajax({
                  type: "GET",
                  url: "http://panel.localhost:8888/containerLog/" + dataItem.id,
                  contentType: "application/json; charset=utf-8",
                  dataType: 'json',
                  success: function(data){
                    if( data.Objects.length === 0 ){
                      $("#dialog").kendoDialog({
                        modal: true,
                        visible: true,
                        title: "Container error",
                        content: "No data to show",
                        width: 800,
                        actions: [{
                          text: "OK",
                          primary: true
                        }]
                      });
                      return
                    }

                    $("#dialog").kendoDialog({
                      modal: true,
                      visible: true,
                      title: "Container Log",
                      content: "<pre class='containerLog'>" + unicodeToChar( data.Objects[0] ) + "</pre>",
                      width: 800,
                      actions: [{
                        text: "OK",
                        primary: true
                      }]
                    });
                  },
                  error: function(data){
                    $("#dialog").kendoDialog({
                      modal: true,
                      visible: true,
                      title: "Container error",
                      content: data.responseJSON.Meta.Error,
                      width: 800,
                      actions: [{
                        text: "OK",
                        primary: true
                      }]
                    });
                  }
                });
                return;

              case 1:
                url = "http://panel.localhost:8888/restContainerStart/" + dataItem.id;
                break;

              case 2:
                url = "http://panel.localhost:8888/restContainerStop/" + dataItem.id;
                break;

              case 3:
                url = "http://panel.localhost:8888/restContainerRemove/" + dataItem.id;
                break;

              case 4:
                url = "http://panel.localhost:8888/restContainerKill/" + dataItem.id;
                break;
            }

            $.ajax({
              type: "GET",
              url: url,
              contentType: "application/json; charset=utf-8",
              dataType: 'json',
              success: function(data){
                popupNotification.show({ message: "Command executed successfully" }, "success");
              },
              error: function(data){
                $("#dialog").kendoDialog({
                  modal: true,
                  visible: true,
                  title: "Container error",
                  content: data.responseJSON.Meta.Error,
                  width: 800,
                  actions: [{
                    text: "OK",
                    primary: true
                  }]
                });
              }
            });
          },
          index: -1
        });
      }

      $(document.body).keydown(function(e) {
        if (e.altKey && e.keyCode === 87) {
          $("#containerListAndDetailsGridView").data("kendoGrid").table.focus();
        }
      });
    });

    function unicodeToChar(text) {
      return text.replace(/\\u[\dA-F]{4}/gi,
          function (match) {
            return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));
          });
    }
    function adjustByteUnit(nFlt){
      if(nFlt >= 1024 * 1024 * 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024 * 1024 * 1024)) + " TB";
      }
      if(nFlt >= 1024 * 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024 * 1024)) + " GB";
      }
      if(nFlt >= 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024)) + " MB";
      }
      if(nFlt >= 1024){
        return adjustDecimalPoint(nFlt / (1024)) + " KB";
      }
      return adjustDecimalPoint(nFlt)  + " B";
    }
    function adjustDecimalPoint(nStr){
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1].substr(0,1) : '';
      return x1;
      //return x1 + x2;
    }





    function containerHostEnvAddNewEnvVarFunction(){
      /*
      // Procura por uma porta válida
      if( containerConfigurationExposedPortsNumberRef.value() == null ){
        $("#dialog").kendoDialog({
          modal: true,
          visible: true,
          title: "Configuration error",
          content: "Please, select a valid port number.",
          width: 400,
          actions: [
            { text: "OK", primary: true, action: function(){ setTimeout( function(){ containerConfigurationExposedPortsNumberRef.focus(); }, 1000); } }
          ]
        });
        return;
      }
      */

      let dataSource = containerHostEnvRef.dataSource;
      containerHostEnvItemsCount += 1;
      containerHostEnvItemsIdToAdd = containerHostEnvItemsCount;

      let dataInDataSource = dataSource.data();
      let pass = true;

      for (var i in dataInDataSource) {
        if( isNaN( i ) ){
          break
        }
        i = parseInt(i);
        if (dataInDataSource[i].EnvVar === $("#EnvVarName").val()) {
          containerHostEnvItemsIdToAdd = dataInDataSource[i].Id;
          pass = false;
          break;
        }
      }

      if( pass === true ) {
        dataSource.add({
          Id: containerHostEnvItemsCount,
          EnvVar: $("#EnvVarName").val()
        });
      }

      dataSource.one("requestEnd", function(args) {
        if (args.type !== "create") {
          return;
        }

        dataSource.one("sync", function() {
          containerHostEnvRef.value(containerHostEnvRef.value().concat([containerHostEnvItemsIdToAdd]));
        });

        $("#EnvVarName").val("");
      });

      dataSource.sync();
    }

    function containerHostExposedPortsAddNewPortFunction(){
      let imageName = containerConfigurationImageNameRef.text();

      // Procura por um nome de container
      if( imageName == "" ) {
        $("#dialog").kendoDialog({
          modal: true,
          visible: true,
          title: "Configuration error",
          content: "Please, select an image name first.",
          width: 400,
          actions: [
            { text: "OK", primary: true, action: function(){ containerConfigurationImageNameRef.open(); } }
          ]
        });
        return;
      }

      // Procura por uma porta válida
      if( containerConfigurationExposedPortsNumberRef.value() == null ){
        $("#dialog").kendoDialog({
          modal: true,
          visible: true,
          title: "Configuration error",
          content: "Please, select a valid port number.",
          width: 400,
          actions: [
            { text: "OK", primary: true, action: function(){ setTimeout( function(){ containerConfigurationExposedPortsNumberRef.focus(); }, 1000); } }
          ]
        });
        return;
      }

      let dataSource = containerHostExposedPortsRef.dataSource;
      containerHostExposedPortsItemsCount += 1;
      containerHostExposedPortsItemsIdToAdd = containerHostExposedPortsItemsCount;

      let dataInDataSource = dataSource.data();
      let pass = true;

      for (var i in dataInDataSource) {
        if( isNaN( i ) ){
          break
        }
        i = parseInt(i);
        if (dataInDataSource[i].Value === $("#ExposedPortsNumber").val() + "/" + $("#ExposedPortsProtocol").val()) {
          containerHostExposedPortsItemsIdToAdd = dataInDataSource[i].Id;
          pass = false;
          break;
        }
      }

      if( pass === true ) {
        dataSource.add({
          Id: containerHostExposedPortsItemsCount,
          Value: $("#ExposedPortsNumber").val() + "/" + $("#ExposedPortsProtocol").val(),
          ImageName: containerConfigurationImageNameRef.text()
        });
      }

      dataSource.one("requestEnd", function(args) {
        if (args.type !== "create") {
          return;
        }

        dataSource.one("sync", function() {
          containerHostExposedPortsRef.value(containerHostExposedPortsRef.value().concat([containerHostExposedPortsItemsIdToAdd]));
        });

        $("#ExposedPortsNumber").data("kendoNumericTextBox").value("");
      });

      dataSource.sync();
    }

    function containerHostEnvVarAddNewEnvVar(){
      containerHostEnvAddNewPortDialogWindowRef.kendoDialog({
        title: "Environments vars from container",
        content: kendo.template($("#containerCreateTemplateEnvVarAddNewEnvVar").html()),
        visible: false,
        modal: true,
        close: function(){

        },
        open: function(){
          containerConfigurationEnvVarNameRef = $("#EnvVarName");

          setTimeout( function(){ containerConfigurationEnvVarNameRef.focus(); }, 1000)
        },
        actions: [
          {
            text: "Close"
          },
          {
            text: "Add",
            action: function(e){
              containerHostEnvAddNewEnvVarFunction();
              return false;
            }
          },
          {
            text: "Add and close",
            action: function(e){
              containerHostEnvAddNewEnvVarFunction();
            },
            primary: true
          }
        ]
      });
      containerHostEnvAddNewPortDialogWindowRef.data("kendoDialog").open();
    }

    function containerHostExposedPortsAddNewPort(){
      containerHostExposedPortsAddNewPortDialogWindowRef.kendoDialog({
        title: "Expose port from container",
        content: kendo.template($("#containerCreateTemplateExposedPortsAddNewPort").html()),
        visible: false,
        modal: true,
        close: function(){

        },
        open: function(){
          $("#ExposedPortsNumber").kendoNumericTextBox({ format: "#" });
          containerConfigurationExposedPortsNumberRef = $("#ExposedPortsNumber").data("kendoNumericTextBox");

          $("#ExposedPortsProtocol").kendoDropDownList();

          setTimeout( function(){ containerConfigurationExposedPortsNumberRef.focus(); }, 1000)
        },
        actions: [
          {
            text: "Close"
          },
          {
            text: "Add",
            action: function(e){
              containerHostExposedPortsAddNewPortFunction();
              return false;
            }
          },
          {
            text: "Add and close",
            action: function(e){
              containerHostExposedPortsAddNewPortFunction();
            },
            primary: true
          }
        ]
      });
      containerHostExposedPortsAddNewPortDialogWindowRef.data("kendoDialog").open();
    }

    function getContainerStatistics(id){
      if( containerStatisticsWaitingData === true ){
        return
      }

      containerStatisticsWaitingData = true;

      $.ajax({
        type: "GET",
        url: "http://panel.localhost:8888/restContainerStatsLog/" + id,
        contentType: "application/json; charset=utf-8",
        dataType: 'json',
        success: function(data){
          containerStatisticsWaitingData = false;

          if( data.Meta.Success !== true ){
            // fixme: mensagem de erro
            return;
          }

          containerStatisticMemPercentData       = [];
          containerStatisticCpuPercentData       = [];
          containerStatisticBlkReadData          = [];
          containerStatisticBlkWriteData         = [];
          containerStatisticNetRxData            = [];
          containerStatisticNetTxData            = [];
          containerStatisticPidsStatsCurrentData = [];

          for( let i = 0; i !== data.Objects.length; i += 1){
            containerStatisticMemPercentData.push( adjustDecimalPoint( data.Objects[ i ].MemPercent * 100 ) );
            containerStatisticCpuPercentData.push( adjustDecimalPoint( data.Objects[ i ].CpuPercent * 100 ) );
            containerStatisticBlkReadData.push( adjustDecimalPoint( data.Objects[ i ].BlkRead / 1024 ) );
            containerStatisticBlkWriteData.push( adjustDecimalPoint( data.Objects[ i ].BlkWrite / 1024 ) );
            containerStatisticNetRxData.push( adjustDecimalPoint( data.Objects[ i ].NetRx / 1024 ) );
            containerStatisticNetTxData.push( adjustDecimalPoint( data.Objects[ i ].NetTx / 1024 ) );
            containerStatisticPidsStatsCurrentData.push( adjustDecimalPoint( data.Objects[ i ].PidsStatsCurrent ) );
          }

          $("#memPercentValue").html( containerStatisticMemPercentData[ containerStatisticMemPercentData.length - 1 ] + "%" );
          $("#cpuPercentValue").html( containerStatisticCpuPercentData[ containerStatisticCpuPercentData.length - 1 ] + "%" );
          $("#blkReadValue").html( adjustByteUnit( containerStatisticBlkReadData[ containerStatisticBlkReadData.length - 1 ] ) );
          $("#blkWriteValue").html( adjustByteUnit( containerStatisticBlkWriteData[ containerStatisticBlkWriteData.length - 1 ] ) );
          $("#netRxValue").html( adjustByteUnit( containerStatisticNetRxData[ containerStatisticNetRxData.length - 1 ] ) );
          $("#netTxValue").html( adjustByteUnit( containerStatisticNetTxData[ containerStatisticNetTxData.length - 1 ] ) );
          $("#pidsStatsCurrentValue").html( containerStatisticPidsStatsCurrentData[ containerStatisticPidsStatsCurrentData.length - 1 ] );

          $("#memPercent").kendoSparkline({
            type: "area",
            data: containerStatisticMemPercentData,
            tooltip: {
              format: "{0}%"
            },
            seriesColors: ["#558B9B"],
          });

          $("#cpuPercent").kendoSparkline({
            type: "area",
            data: containerStatisticCpuPercentData,
            tooltip: {
              format: "{0}%"
            },
            seriesColors: ["#558B9B"],
          });

          $("#blkRead").kendoSparkline({
            type: "area",
            data: containerStatisticBlkReadData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#blkWrite").kendoSparkline({
            type: "area",
            data: containerStatisticBlkWriteData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#netRx").kendoSparkline({
            type: "area",
            data: containerStatisticNetRxData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#netTx").kendoSparkline({
            type: "area",
            data: containerStatisticNetTxData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#pidsStatsCurrent").kendoSparkline({
            type: "area",
            data: containerStatisticPidsStatsCurrentData,
            tooltip: {
              format: "{0}"
            },
            seriesColors: ["#558B9B"],
          });
        }
      });
    }
  </script>
  <script id="containerHostExposedPortsFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostExposedPortsAddNewPort()">Add new port and protocol</button>
  </script>
  <script id="containerHostExposedPortsTemplate" type="text/x-kendo-tmpl">
    <span>Port: #= Value #<br>Usually used in: #= ImageName #</span>
  </script>
  <script id="containerHostExposedPortsNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No ports found to add. Please add a port and a protocol before continuing.
    </div>
  </script>
  <script id="containerHostEnvFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostEnvVarAddNewEnvVar()">Add new enviromment var</button>
  </script>
  <script id="containerHostEnvTemplate" type="text/x-kendo-tmpl">
    <span>Environment var: #= EnvVar #</span>
  </script>
  <script id="containerHostEnvNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No environments vars found to add. Please add an environment var before continuing.
    </div>
  </script>
















  <script id="successTemplate" type="text/x-kendo-template">
    <div class="success">
      <img src="http://localhost:8888/static/template/notifications/success-icon.png" />
      <h3>#= message #</h3>
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplate">
    <form id="ticketsForm">
      <ul id="fieldlist">
        <li>
          <label for="hostname" title="Host name">Host name</label>
          <input type="text" id="hostname" name="hostname" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>
        <li>
          <label for="domainname" title="Domain name">Domain name</label>
          <input type="text" id="domainname" name="domainname" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>
        <li>
          <label for="user" title="User that will run the command(s) inside the container, also support user:group">User</label>
          <input type="text" id="user" name="user" class="k-textbox" placeholder="user or user:group" validationMessage="Enter a {0}" />
        </li>
        <li>
          <label for="attachStdin" title="Attach the standard input, makes possible user interaction">Attach std in</label>
          <input type="checkbox" id="attachStdin" name="attachStdin" checked="checked" />
        </li>
        <li>
          <label for="attachStdout" title="Attach the standard output, makes possible user interaction">Attach std out</label>
          <input type="checkbox" id="attachStdout" name="attachStdout" checked="checked" />
        </li>
        <li>
          <label for="attachStderr" title="Attach the standard error, makes possible user interaction">Attach std error</label>
          <input type="checkbox" id="attachStderr" name="attachStderr" checked="checked" />
        </li>

        <!-- ExposedPorts -->

        <li>
          <label for="try" title="Attach standard streams to a tty, including stdin if it is not closed.">Try</label>
          <input type="checkbox" id="try" name="try" checked="checked" />
        </li>
        <li>
          <label for="openStdin" title="Open standard in">Open standard in</label>
          <input type="checkbox" id="openStdin" name="openStdin" checked="checked" />
        </li>
        <li>
          <label for="stdinOnce" title="If true, close stdin after the 1 attached client disconnects.">Std in once</label>
          <input type="checkbox" id="stdinOnce" name="stdinOnce" />
        </li>

        <!-- env -->
        <!-- cmd -->
        <!-- Healthcheck -->

        <li>
          <label for="argsEscaped" title="True if command is already escaped (Windows specific)">Args Escaped</label>
          <input type="checkbox" id="argsEscaped" name="argsEscaped" />
        </li>
        <li><!-- rever isto. deve uma lista fornecida pelo sistema -->
          <label for="image" class="required" title="Name of the image as it was passed by the operator (e.g. could be symbolic)">Image</label>
          <input type="text" id="image" name="image" class="k-textbox" placeholder="" required validationMessage="Enter a {0}" />
        </li>

        <!-- Healthcheck -->

        <li>
          <label for="workingrir" title="Name of the image as it was passed by the operator (e.g. could be symbolic)">Working dir</label>
          <input type="text" id="workingrir" name="workingrir" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>

        <!-- Entrypoint -->

        <li>
          <label for="networkdisabled" title="Is network disabled">Network Disabled</label>
          <input type="checkbox" id="networkdisabled" name="networkdisabled" />
        </li>
        <li>
          <label for="macaddress" title="Mac Address of the container">Mac Address of the container</label>
          <input type="text" id="macaddress" name="macaddress" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>

        <!-- OnBuild -->
        <!-- Labels -->

        <li>
          <label for="stopsignal" title="Signal to stop a container">Stop Signal</label>
          <input type="text" id="stopsignal" name="stopsignal" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>
        <li><!-- deve ser numerico -->
          <label for="stoptimeout" title="Timeout (in seconds) to stop a container">Stop Timeout</label>
          <input id="stoptimeout" name="stoptimeout" type="text" min="0" value="0" placeholder="" />
          <span class="k-invalid-msg" data-for="stoptimeout"></span>
        </li>

        <!-- shell -->

        <label>Network</label>
        <hr>

        <li>
          <label for="hostname" title="Host name">Host name</label>
          <input type="text" id="hostname" name="hostname" class="k-textbox" placeholder="" validationMessage="Enter a {0}" />
        </li>

      </ul>
    </form>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateExposedPortsAddNewPort">
    <span>
      <input type="text" id="ExposedPortsNumber" name="ExposedPorts" class="oneThirdSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
      <select id="ExposedPortsProtocol" class="oneThirdSize" autocomplete="off" >
        <option>TCP</option>
        <option>UDP</option>
      </select>
    </span>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateEnvVarAddNewEnvVar">
    <span>
      <input type="text" id="EnvVarName" name="env" class="k-textbox envVarSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
    </span>
  </script>




  <script type="text/x-kendo-template" id="containerDetailsTemplate">
    <h2>Name: #= name #</h2>
    <em>Image: #= image #</em>
    <table class="containerData">
      <tr>
        <td class="col1">Mem: </td>
        <td class="col2"><span id="memPercent"></span></td>
        <td class="col3" id="memPercentValue">0%</td>
      </tr>
      <tr>
        <td class="col1">CPU: </td>
        <td class="col2"><span id="cpuPercent"></span></td>
        <td class="col3" id="cpuPercentValue">0%</td>
      </tr>
      <tr>
        <td class="col1">Block read: </td>
        <td class="col2"><span id="blkRead"></span></td>
        <td class="col3" id="blkReadValue">0kB</td>
      </tr>
      <tr>
        <td class="col1">Block write: </td>
        <td class="col2"><span id="blkWrite"></span></td>
        <td class="col3" id="blkWriteValue">0kB</td>
      </tr>
      <tr>
        <td class="col1">Net rx: </td>
        <td class="col2"><span id="netRx"></span></td>
        <td class="col3" id="netRxValue">0kB</td>
      </tr>
      <tr>
        <td class="col1">Net tx: </td>
        <td class="col2"><span id="netTx"></span></td>
        <td class="col3" id="netTxValue">0kB</td>
      </tr>
      <tr>
        <td class="col1">Pids: </td>
        <td class="col2"><span id="pidsStatsCurrent"></span></td>
        <td class="col3" id="pidsStatsCurrentValue">0</td>
      </tr>
    </table>

    <dl>
      <dt>Status: <b>#= status #</b></dt>
      <dt>Created date: <b>#= kendo.toString(createdYear, "dd/MM/yyyy HH:mm") #</b></dt>
    </dl>
    <div id="containerActions">
      <span>
        View Log
      </span>
      <span>
        Start
      </span>
      <span>
        Stop
      </span>
      <span>
        Remove
      </span>
      <span>
        Kill
      </span>
    </div>
  </script>
</div>
<span id="popupNotification"></span>
<div id="dialog"></div>
</body>
</html>